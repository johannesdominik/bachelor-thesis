\chapter{Use Cases of Decentralized Finance}
\label{cha:UseCasesDecentralizedFinance}

This chapter aims to introduce the five most relevant use cases of Decentralized Finance. Each use case is built on top of the previous one and rises in complexity. For example storing value in digital systems is quite easy nowadays but moving real physical assets such as gold or real estate into a blockchain is still pretty demanding. Note, that each type of financial service is not specific to Decentralized Finance, which means that they are applicable to every financial environment.

\section{Classification of Financial Services}
The digitalization changed the financial industry. A few years ago, a lot of new companies with a significant online presence\footnote{often referred as fintech}, entered the market and changed the way how people interact with financial services. And now, the industry is experiencing again a new shift to more and more decentralized platforms and applications. But even tough the interaction interface changes from time to time, the underlying types of services we use in the financial sector stay the same. The fundamental service that is necessary to build a financial ecosystem is some kind of value storage. Once that is created, it is logical to have the ability to transfer this value to other people in order to compensate them for a product or service. The most popular and dominating use case of banks, which is lending builds on top of that. Once the ecosystem gets more mature, new types of value storage are introduced and people need a way to exchange two value storages for each other.

The last and the most sophisticated use case occurs, when people try to map complex real world examples in that financial ecosystem, such as securities, insurances and derivatives. In 2021, Decentralized Finance is about to enter exactly that use case. On a blockchain, this is called tokenization. A token is a new value store that is built on top of another cryptocurrency. At the time of writing this in January 2021, Chainlink\cite{Chainlink} is the token with the highest market capitalization of \$9 Billion\cite{CoinMarketCap2021} with the purpose of connecting real world data with the Ethereum blockchain\footnote{known as oracle networks}.

\section{Store of Value}
\label{sec:storeofvalue}
No matter of the financial product or service, they all need one essential thing. In fact, our entire economic system depends on it: a currency, or in simpler terms, something to store value. Storing value is a fundamental trait of money alongside with being exchangeable and having a unit of account. The last two characteristics are comparatively easy to accomplish in the online world. Storing value in a digitalized way without having a central trusted authority, however, was a similar challenge as the people had to face in the early days when they started to switch from bartering to a real currency. A common consensus needs to be created where everyone can easily verify that a specific piece of money is authentic and wasn't created illegally. Even further, each person that uses this money needs a proof that it is storing real value. This wasn't possible until Satoshi Nakamoto, an anonymous person or group, published a specification \cite{Nakamoto2008} in 2008, on how digital money could be implemented. The first cryptocurrency was founded: Bitcoin.

\subsection{Proof of Work}
Bitcoin uses a mechanism called proof-of-work in order to give each block its value. This utilizes a cost-function which is designed to be easily verifiable but quite expensive to compute \cite{Back2002}. In order to create a new block, a value needs to be found that matches with the correct number of zero bits of the block hash. Once the correct solution has been found, the new block represents real value, because operating this computationally intensive task on a CPU costs a lot of electricity. The integrity of this block is guaranteed as well, because in order to change the history of the blockchain, each changed block needs to be re-computed. The longest chain of blocks on the network is accepted as the "truth", so if dishonest people want to cheat and change the history of the blockchain, they would need to create the longest chain of blocks which can be only achieved by having more than 50\% of the computing power of the whole network. While these so-called 51\% attacks are a threat on blockchains with a smaller number of network members, it is very unlikely to happen on a well established network like the Bitcoin blockchain \cite{Swan2015}. The concept of proof-of-work in order to achive consensus in a decentralized manner became very popular and can be used in other areas of application too, such as elections, lotteries, asset registries, digital notarization and more \cite{Antonopoulos2017}.

\subsection{Proof of Stake}
A different approach to storing digital value is proof-of-stake. Instead of making the participants of the network solve computational expensive problems, the consensus is created by proving that someone owns specific funds. A blockchain that uses a proof-of-stake algorithm to achieve consensus has a set of validators. These validators are running a master node which gives them the opportunity to vote. In order to do so, the validators need to prove that they own a specific amount of funds. This is done by sending a special transaction, which locks away their currencies for a specific time. If the validators are honest and their vote corresponds to the result of the majority, they will get their funds back and an additional reward proportional to their deposited stake. If their vote gets rejected, the dishonest validator risks loosing his money \cite{AntonopoulosWood2018}.

\subsection{Switching the Consensus Algorithm}
At the time of writing this in January 2021, the Ethereum blockchain uses a similar proof-of-work algorithm like Bitcoin, called \textit{Ethash}. However, Ethereum is about to switch to a proof-of-stake algorithm called \textit{Casper} in the near future \cite{Twitter2018}. Algorithms that are based on proof-of-stake have the big advantage of less energy consumption because they are not focused on computational intensive tasks. But proof-of-stake comes with a caveat as well. Implementing incentives on a voting system which are based on the amount each validator is willing to stake means that the rich validators get richer and the poor validators stay poor.

The process of changing a consensus algorithm of a blockchain is not easy to accomplish. Because the network is decentralized, there is no single entity which can force all members to change the algorithm from proof-of-work to proof-of-stake. Just letting the people choose what they prefer to use is also not a good idea, because it is very unlikely that all agree on one type of algorithm. That would probably trigger a hard fork of the blockchain resulting in two separate networks, similar to what happened to Bitcoin in August 2017.

Bitcoin's network is by design very slow in verifying transactions. A block which is mined approximately every 10 minutes has a size of about 1 MB. Due to the small block size, Bitcoin is only capable of processing 7 transactions per second. Some people wished for a Bitcoin network which is more suitable for day to day payments. That is why \textit{Bitcoin Cash} was created, emerged out of a hard fork of the Bitcoin network \cite{BitcoinCash2020} \cite{HillChopraValencourt2018}. In order to prevent a hard fork on Ethereum due to the transition from proof-of-work to proof-of-stake, the Ethereum protocol has a built in mechanism called \textit{difficulty bomb} which makes it more difficult over time to be profitable with mining\footnote{used synonymously to proof-of-work} by increasing the size of the problem to solve \cite{Wood2020}. This ensures a smooth transition of all members to switch to proof-of-stake.

For the majority of users on the blockchain which are neither miners nor validators it does not matter which consensus algorithm is being used. In fact, it is not even important when developing decentralized applications based on smart contracts like it is done in chapter \ref{cha:DesignArchitecture}. The only thing that makes an impact is, that the blockchain is able to store real value on the network by reaching consensus by its members.

\section{Payments}
\subsection{Bitcoin}
When thinking about a cryptocurrency that can be used for payments, usually Bitcoin is the one that comes first into mind. And that is justified. Bitcoin was the first cryptocurrency and has by far the highest market capitalization. But when it comes to payments, Bitcoin is a really poor choice.

Bitcoin is too volatile. It is not uncommon that the price of Bitcoin fluctuates a few thousand dollars per day. Merchants who try to sell their products with Bitcoin have a really hard time if the revenue of yesterday is only worth the half today. There are a lot of reasons for Bitcoin's volatilty and that will not change in the near future. 

Bitcoin is too slow. The block time on the Bitcoin blockchain is approximately 10 minutes. Transactions take a long time to be verified by the network. Too long for a cashier to wait for a proof that his customer made a correct transaction.

Bitcoin is too deflationary. By design, Bitcoin has a fixed supply of 21 million. As Bitcoin gets more popular over time, it is only logical that its price increases. While this is a pleasant thing for investors, it is an unwanted sideeffect for a financial economy, because everyone refuses to spend their coins as they increase in value.
\subsection{Centralized Stable Coins}
There are a few strategies to remove the volatility from a digital asset. The most popular way is by pegging a cryptocurrency or token to a reference fiat currency like the US dollar. This is achieved by collateralizing every unit of the digital asset with a unit in the reference currency. This works pretty well, but the problem is, that this is a quite centralized approach, as the collateralization is managed by a central authority. However, this is a very common way and the biggest stable coins such as Tether\cite{Tether2021}, USD Coin\cite{USDCoin2021} and Gemini Dollar\cite{GeminiDollar2021} operate using collateralization.

\subsection{Dynamic Supply Protocols}
The price of an asset is driven by supply and demand. If the supply is larger than the demand, the price of this asset falls and vice versa. Most assets have a fixed supply, or at least a fixed distribution schedule, which gives the market forces full control over the price. But if the supply is being controlled, the price can be controlled as well. Dynamic supply protocols do this by increasing the supply if the demand increases and take out supply if the market is experiencing a reduced demand. This results in an almost stable price. A token that was one of the first that implemented such a dynamic supply protocol is Ampleforth\cite{Ampleforth}. As the demand increases, the amount of coins in each wallet will increase as well, while keeping the same proportions of the market share.

\subsection{Stability Protocols}
Although dynamic supply protocols work pretty well, it can be really confusing for users, if the amount of that asset in their wallet fluctuates on a daily basis. Stability protocols take a different approach by controlling the price through incentives instead of changing the supply. If the demand increases, the protocol makes it less attractive to buy that asset and rewards users that buy when the demand is low. The bigger the market capitalization of that asset, the more accurate is the price. Decentralized exchanges work in a similar way as described later in section \ref{subsec:liquiditypools}. A common token using stability protocols is Maker\cite{MakerDAO2021}, which is by far the project with the most value locked\footnote{\$4.5 Billion (as of January 2021, https://defipulse.com/)} in Decentralized Finance.

\section{Lending \& Borrowing}
Lending and borrowing is the main business model of banks in traditional finance. In order to assess their risks, banks force their customers to do an identification. Therefore, it is a lot easier to evaluate the probability to receive their funds back. And even if they don't, they can initiate legal ways to get their money back.
In Decentralized Finance, this is a lot more difficult. All users are anonymous and not regulated in any way. The network needs to find new mechanisms to make sure, the users, behave as expected. Section \ref{sec:storeofvalue} introduces two approaches to make it more attractive for users to play by the rules: incentives and punishments. The system of incentivization is used in the consensus protocol Proof of Work, where people receive a reward if they help to support the network. A punishment is used in Proof of Stake, as people will loose their collateral, if they vote for the wrong blocks. This system is used as well in lending applications. In order to borrow a specific asset, the user needs to deposit a collateral first, before he can withdraw the loan. If specific conditions are met, e.g. the price of the collateralized asset falls below a certain value, the user will get liquidated and looses his collateral.

While this system is the most popular right now, it only makes sense for users if they think that their collateral will grow in value as time goes by, otherwise
they would just swap their collateral in the asset they need. Most cryptocurrencies are deflationary by nature, so they are supposed to increase in value.
Stablecoins, however, such as Tether or Dai, are designed to have a constant value as good as possible. Therefore, collateralized lending works best with a
deflationary asset and a stablecoin. This is exactly what Maker\cite{MakerDAO2021}, the most popular lending project does, using Ether and Dai.

As decentralized exchanges become more popular, an alternative type of lending arises: liquidity mining. It is completely different than collateralized lending and
serves a real use case by providing liquidity to an exchange. Section \ref{subsec:liquiditypools} describes this technique in more detail.


\section{Exchanging}
\subsection{Characteristics of Decentralized Exchanges}
With the arise of many new fintech enterprises in the last few years, online exchanges started to grew in importance on the market as well. While they all were very centralized in the first place, Decentralized Finance made it possible to establish new ways of exchanging money. Although each online exchange may behave very different, they can be all categorized into three big types when it comes to their structure: Centralized, decentralized and non-custodial exchanges. Centralized exchanges (CEXes) are the traditional approach where all the power is centralized to one specific organization. Decentralized exchanges (DEXes), however, are the complete opposite where there is no single entity in control and decisions are made completely based on Smart Contracts. Non-custodial exchanges are somewhere inbetween but are often confused with decentralized exchanges. It is important to note, that none of the types are superior in comparison to the others. Each type of exchange has its own benefits and risks. In order to assess whether an exchange is suitable for a specific use case, it is crucial to know how to classify it.

Probably the most apparent indicator is the ownership of the private keys. On CEXes, the assets are coffered for the user. If someone buys Bitcoin on a centralized exchange, private keys are never an issue. On non-custodial and decentralized exchanges you have to manage your private keys by yourself. While this is usually a good thing, because you don't have to trust someone else\footnote{often referred to as "not your keys, not your coins"}, it comes also with the risk of losing all your assets if you forget your private key, since nobody can restore it for you.

Owning your private keys is a good indicator but by far not the only trait a decentralized exchange needs to have. When looking at the technical infrastructure of the exchange, many things could be structured in a centralized manner. While the code of a centralized exchange is usually proprietary, a DEX needs to have code that is licensed exclusively with an open-source licence, making it possible for anyone to fork the project in case the service is no longer available. That is also highly related to emergencies. How does an exchange react to bad or unexpected events such as hacking attacks? CEXes have the option to put their service temporarly offline until the issue is resolved, in order to save the funds of the users. On decentralized exchanges, there is no such thing and assets may be lost forever.

Another crucial topic to consider is censorship and geo blocking. If the service is not available in the whole world, it is not a DEX. Centralized exchanges always decide which coins are listed on the exchange, which is usually a pay to play model. Decentralized exchanges don't have such regulation. Anyone can add a new pair of coins to swap on a DEX, which often leads to a tremendously high amount of unknown and irrelevant listed coins.

The last key indicator on how to categorize an online exchange is the way how the order matching and the settlement works. Centralized exchanges use the same algorithm as stock exchanges, which utilizes an order book. Buy and sell orders are listed in a centralized ledger and the settlement happens when two orders match. Non-custodial exchanges usually use price oracles which try to get price information \cite[p.\ 47]{WuSun2018}. Truly decentralized exchanges even go a step further and solve this problem without a third party price oracle. A DEX uses a concept that relies on Liquidity Pools, which will be discussed in detail in the next section.

\subsection{Liquidity Pools}
\label{subsec:liquiditypools}
Every decentralized exchange needs liquidity. Because there is no order book, assets have to be already on the exchange before the user wants to swap two coins. In order to achieve that, the DEX depends on Liquidity Providers, which add their funds to the exchange. Liquidity Providers get rewarded\footnote{known as Liquidity Mining} by the DEX because nobody provides liquidity for free. The rewards can be taken from the exchange fees, which are usually still lower than on CEXes. For example, Uniswap, one of the biggest decentralized exchanges rewards each Liquidity Provider with 0.3\% of each transaction taking place on that Liquidity Pool proportional to their share of the pool \cite{Uniswap2020}. If there is a yearly transaction volume on the pair Ether/Tether USD of \$17.7 billion and the Liquidity Provider owns a 0.1\% share of this pool, he will be rewarded with \$53.100 per year. The share is usually expressed through Pool Tokens, which can be traded as well.

Liquidity Providers can only provide liquidity in pairs. If someone wants to provide liquidity to the WBTC-ETH pair, which is Wrapped Bitcoin\footnote{Bitcoin as a token on the Ethereum network} and Ether, he needs to add the same value both in WBTC and ETH. People who want to swap their WBTC to ETH add only one asset of that pair and receive the other one, which creates an imbalance in that specific pool. The total value stays the same but the proportion of the assets change. In this example, there is more Ether compared to Wrapped Bitcoin after the swap. This makes it very attractive for the market to swap ETH back to WBTC, because the user will get proportional more WBTC for less ETH\footnote{this phenomenon is called arbitrage and applies to all efficient markets}. In high-volume markets this imbalance will be exploited very soon and the original proportion is restored.

If a Liquidity Pool of a specific trading pair is very small, there is a risk of clearing the entire pool by a single transaction, which would give away the associated asset almost for free in the next transaction. In order to prevent that, a user never gets the entire value in the swapped asset. The difference between the expected and the actual value is called slippage. That might seem annoying in the first place, but it is a crucial instrument for the exchange to work properly. This happens on exchanges with an order book too, because it is very unlikely that both a buy and a sell order have the exact same price. The deeper\footnote{in terms of more orders and more liquidity} the order book or the Liquidity Pool, the lower the percentage of the price slippage. If someone makes a high volume order on a small order book or Liquidity Pool, he will experience high slippage because his order wipes out a lot of opposite orders on a CEX and uses a high pool percentage on a DEX \cite{Hosp2020}.

\subsection{Risks}
While providing liquidity to an exchange pool might look very profitable at first, there are also certain risks the Liquidity Provider has to deal with. Smart Contract risk is something which you are automatically exposed to when trusting software instead of people. Because software is still written by people and people make mistakes, there is no guarantee that the Smart Contract on a DEX works completely the way it should be. On a turing complete network such as Ethereum with programming languages like Solidity the risk is even higher because you can literally do anything in a Smart Contract. Because a Smart Contract is deployed only once, it is impossible to fix errors once it is public on a blockchain. This risk is far less present on networks which are not turing complete such as Bitcoin.

Even if the Smart Contract risk is eliminated as good as possible by writing a lot of tests, there is still the project risk, that the developers might deliberately implement errors and backdoors into their code in order to disburse liquidity to themselves. This is often the case when the project has poor auditing and if the founders are not known to the public.

Impermanent Loss is the last and most present risk liquidity providers are exposed to. The explanation of a Liquidity Pool in the last section is missing an important factor. Even if there is no one trading an asset pair, an imbalance can still occur because each asset is volatile by itself unless the asset pair consists of two stable coins pegged to the same fiat currency. Impermanent Loss always exists if one of the two assets has large price fluctuations in a short amount of time. And while it is usually good to diversify an investment, Impermanent Loss has an even greater impact on non-correlating assets, because the price difference can be much higher. The only way to reduce the risk of Impermanent Loss is to have a larger time horizon where you can choose a good time to cash out the liquidity. Unfortunately there is no such thing as Impermanent Win because it is always a loss once one of the two assets fluctuates. The loss is expressed through the loss in the Liquidity Pool compared to the price gains by holding each asset separately.

\section{Investing}
\subsection{Tokens}
Investing in crypto currencies is already exciting. But Ethereum offers an even more customizable investing experience through tokens. Based on different standards, applications can create tokenized products according ot their needs. The most popular token standard on the Ethereum network is the ERC-20 standard, which is described in detail in section \ref{sec:ERC20}. This standard has its flaws, for example, the gas fees are very high because there are separate transaction for token approval and transfer. There are already better alternatives out there, such as the standards ERC-223, ERC-777 and ERC-820 which are built on top of ERC-20. However, they are rarely supported by wallets and applications.

The ERC-721 standard is different than the others. It makes it possible to create non-fungible tokens, where different tokens can hold different values. This feature is the foundation to tokenize real-world assets, such as stocks, real estate and works of art.

\subsection{Synthetic Assets}
While it is possible, to tokenize almost everything, from basketball players to entire supply chains of companies, the most obvious idea is to tokenize other
financial asset classes such as marketable securities. There are a few good reasons, why it is likely that synthetic assets are the first major use case of
tokenization. Firstly, it is not very difficult to implement. Tokens which represent another asset, just need to be backed up with the same amount denoted in that
asset, similar to how stablecoins like Tether work. Secondly, synthetic assets solve the centralization issue in other asset classes, as stocks, bonds or REITs
are managed by a central investing firm. Investors who hold shares of tokenized stocks, are independent from brokers, stock exchanges, business hours, regulations
and more.
